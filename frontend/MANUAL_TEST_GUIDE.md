# 🧪 UAI教育平台认证系统 - 手动测试指南

## 🎯 测试目标
验证P0级修改完成后，认证系统的完整链路是否正常工作

## 🔧 准备工作

### 1. 启动后端服务
```bash
cd ../backend
python manage.py runserver 8000
```

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```

### 3. 准备测试数据
- 测试手机号：13800138000
- 测试密码：test123456

## 📋 测试场景

### **场景1：持久化验证**

#### 测试步骤：
1. 打开 `http://localhost:5173`
2. 登录后刷新页面
3. 检查是否保持登录状态
4. 打开开发者工具 > Application > Local Storage
5. 验证 `uai-auth` 键下只存储了指定字段

#### 预期结果：
- ✅ 刷新后保持登录状态
- ✅ localStorage中只有：`accessToken`, `refreshToken`, `userInfo`
- ✅ 敏感计算属性（如密码）不被持久化

---

### **场景2：Token自动刷新**

#### 测试步骤：
1. 登录成功后
2. 开发者工具 > Application > Local Storage
3. 手动修改 `accessToken` 为无效值（如添加 `invalid` 后缀）
4. 访问需要登录的页面（如 `/user`）
5. 观察网络请求和控制台日志

#### 预期结果：
- ✅ 自动触发Token刷新
- ✅ 刷新成功后重新发起原请求
- ✅ 页面正常加载，无需重新登录
- ✅ 控制台显示刷新成功日志

---

### **场景3：路由保护**

#### 测试步骤：
1. **未登录状态**：
   - 直接访问 `http://localhost:5173/user`
   - 直接访问 `http://localhost:5173/cart`
   - 直接访问 `http://localhost:5173/order`

2. **已登录状态**：
   - 访问 `http://localhost:5173/login`

#### 预期结果：
- ✅ 未登录时自动跳转到 `/login?redirect=原页面路径`
- ✅ 已登录时访问登录页自动跳转到首页
- ✅ 登录成功后自动跳转到原目标页面

---

### **场景4：登录方式验证**

#### A. 密码登录
1. 访问 `/login`
2. 输入手机号：13800138000
3. 输入密码：test123456
4. 勾选用户协议
5. 点击登录

#### B. 验证码登录
1. 切换到"手机验证码登录"
2. 输入手机号：13800138000
3. 点击"获取验证码"
4. 等待倒计时和后端日志
5. 输入验证码（从后端日志获取）
6. 点击登录

#### 预期结果：
- ✅ 密码登录成功，跳转到目标页面
- ✅ 验证码按钮显示倒计时60秒
- ✅ 验证码登录成功，状态同步
- ✅ 手机号格式验证生效（11位大陆号码）

---

### **场景5：错误处理**

#### A. 网络错误
1. 关闭后端服务
2. 尝试登录
3. 观察错误提示

#### B. Token过期
1. localStorage中删除 `refreshToken`
2. 模拟Token过期（修改accessToken）
3. 访问需要认证的页面

#### 预期结果：
- ✅ 网络错误时显示友好提示
- ✅ Token无法刷新时跳转到登录页
- ✅ 跳转使用 `router.replace` 避免历史堆叠

---

### **场景6：登出功能**

#### 测试步骤：
1. 登录成功
2. 在个人中心点击退出登录
3. 检查localStorage
4. 尝试访问需要认证的页面

#### 预期结果：
- ✅ localStorage被清空
- ✅ 自动跳转到登录页
- ✅ 后端收到登出请求（检查网络面板）

---

## 🔍 关键检查点

### **控制台日志**
- ✅ `🚀 API请求: POST /api/users/auth/login/`
- ✅ `✅ API响应: /api/users/auth/login/ - 200`
- ✅ `🔄 Token失效，尝试刷新...`
- ✅ `✅ Token刷新成功，重新发起请求`

### **Network面板**
- ✅ 请求头包含 `Authorization: Bearer xxx`
- ✅ 401响应自动触发刷新请求
- ✅ 刷新成功后原请求重新发送

### **Application面板**
- ✅ `uai-auth` 键的内容结构正确
- ✅ 刷新页面后状态保持
- ✅ 登出后localStorage清空

### **开发者体验**
- ✅ 无明显的加载延迟
- ✅ 错误提示清晰易懂
- ✅ 表单验证及时响应

---

## 🐛 已知限制

1. **手机号格式**：目前仅支持大陆11位手机号（根据需求）
2. **验证码有效期**：60秒倒计时，实际验证码有效期由后端控制
3. **Token刷新**：最多重试1次，避免无限循环

---

## 📊 测试报告模板

```
测试时间：____年____月____日
测试人员：____________
测试环境：
- 前端：http://localhost:5173
- 后端：http://localhost:8000
- 浏览器：____________

| 测试场景 | 状态 | 备注 |
|---------|------|------|
| 持久化验证 | ✅/❌ |  |
| Token自动刷新 | ✅/❌ |  |
| 路由保护 | ✅/❌ |  |
| 密码登录 | ✅/❌ |  |
| 验证码登录 | ✅/❌ |  |
| 错误处理 | ✅/❌ |  |
| 登出功能 | ✅/❌ |  |

问题记录：
_______________
```

---

## 🚀 下一步：进入courses模块

认证系统测试完成后，即可开始courses模块开发：

1. **后端**：`python manage.py startapp courses`
2. **前端**：创建 `src/services/course.ts`
3. **目标**：本周实现"登录 → 课程浏览"完整链路 