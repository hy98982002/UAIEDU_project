# ğŸ‰ UAIæ•™è‚²å¹³å°ç”¨æˆ·ç³»ç»Ÿå®ç°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ **å®ç°æ¦‚è§ˆ**

æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæˆ‘å·²ç»æˆåŠŸå»ºç«‹äº†UAIæ•™è‚²å¹³å°çš„ç”¨æˆ·æ•°æ®åº“ç³»ç»Ÿï¼Œå®Œå…¨ç¬¦åˆä½ çš„åŠŸèƒ½è¦æ±‚ï¼š

âœ… **æ‰‹æœºå·æ³¨å†Œç³»ç»Ÿ** - åªæ¥å—æ‰‹æœºå·æ³¨å†Œ  
âœ… **å”¯ä¸€æ ‡è¯†ç”Ÿæˆ** - è‡ªåŠ¨ç”Ÿæˆ `uai{æ‰‹æœºå·}dx` æ ¼å¼çš„å”¯ä¸€æ ‡è¯†  
âœ… **å¾®ä¿¡ç»‘å®šåŠŸèƒ½** - æ”¯æŒåç»­ç»‘å®šå¾®ä¿¡å¼€é€šå¾®ä¿¡ç™»å½•  
âœ… **æ˜µç§°ç®¡ç†** - é»˜è®¤ä½¿ç”¨æ ‡è¯†å·ï¼Œç”¨æˆ·å¯ä¿®æ”¹æ˜µç§°ä½†æ ‡è¯†å·ä¸å¯æ”¹  
âœ… **BaseModelåŸºç¡€ç±»** - åŒ…å« add_time ç­‰é€šç”¨å­—æ®µ  

---

## ğŸ—ï¸ **æ•°æ®åº“æ¶æ„è®¾è®¡**

### 1. **BaseModel (åŸºç¡€æ¨¡å‹ç±»)**
```python
- id: UUIDä¸»é”®
- add_time: æ·»åŠ æ—¶é—´ (datetime.now)
- update_time: æ›´æ–°æ—¶é—´ (auto_now)
- is_active: æ˜¯å¦æ¿€æ´»
```

### 2. **User (ç”¨æˆ·ä¸»è¡¨)**
```python
- phone: æ‰‹æœºå· (å”¯ä¸€, ç™»å½•å‡­è¯)
- unique_identifier: å”¯ä¸€æ ‡è¯† (uai{æ‰‹æœºå·}dxæ ¼å¼, ä¸å¯ä¿®æ”¹)
- nickname: ç”¨æˆ·æ˜µç§° (å¯ä¿®æ”¹, é»˜è®¤=å”¯ä¸€æ ‡è¯†)
- email: é‚®ç®± (å¯é€‰)
- is_phone_verified: æ‰‹æœºéªŒè¯çŠ¶æ€
- add_time, update_time: æ—¶é—´æˆ³
```

### 3. **UserProfile (ç”¨æˆ·èµ„æ–™)**
```python
- real_name: çœŸå®å§“å
- gender: æ€§åˆ« (ç”·/å¥³/å…¶ä»–)
- birth_date: å‡ºç”Ÿæ—¥æœŸ
- avatar: å¤´åƒå›¾ç‰‡
- qq, wechat: è”ç³»æ–¹å¼
- province, city, address: åœ°å€ä¿¡æ¯
- bio: ä¸ªäººç®€ä»‹
```

### 4. **WeChatBinding (å¾®ä¿¡ç»‘å®š)**
```python
- openid: å¾®ä¿¡OpenID
- unionid: å¾®ä¿¡UnionID
- wechat_nickname: å¾®ä¿¡æ˜µç§°
- wechat_avatar: å¾®ä¿¡å¤´åƒURL
- is_bound: ç»‘å®šçŠ¶æ€
- bind_time: ç»‘å®šæ—¶é—´
```

### 5. **UserSetting (ç”¨æˆ·è®¾ç½®)**
```python
- email_notifications: é‚®ä»¶é€šçŸ¥å¼€å…³
- sms_notifications: çŸ­ä¿¡é€šçŸ¥å¼€å…³
- wechat_notifications: å¾®ä¿¡é€šçŸ¥å¼€å…³
- profile_public: èµ„æ–™å…¬å¼€è®¾ç½®
- learning_progress_public: å­¦ä¹ è¿›åº¦å…¬å¼€è®¾ç½®
- preferred_language: é¦–é€‰è¯­è¨€
- extra_settings: JSONæ‰©å±•è®¾ç½®
```

### 6. **LoginLog (ç™»å½•æ—¥å¿—)**
```python
- login_type: ç™»å½•æ–¹å¼ (æ‰‹æœºå¯†ç /éªŒè¯ç /å¾®ä¿¡)
- ip_address: IPåœ°å€
- user_agent: ç”¨æˆ·ä»£ç†
- is_success: ç™»å½•ç»“æœ
- fail_reason: å¤±è´¥åŸå› 
- location: ç™»å½•åœ°ç‚¹
```

---

## ğŸ”‘ **æ ¸å¿ƒåŠŸèƒ½å®ç°**

### **1. å”¯ä¸€æ ‡è¯†å·ç”Ÿæˆé€»è¾‘**
```python
def generate_unique_identifier(phone):
    """
    ç”Ÿæˆæ ¼å¼: uai{æ‰‹æœºå·}dx
    - phone: 18512291362
    - result: uai18512291362qt (qtä¸ºéšæœº2ä½å­—ç¬¦)
    """
    random_suffix = ''.join(random.choices(string.ascii_lowercase + string.digits, k=2))
    unique_id = f"uai{phone}{random_suffix}"
    
    # ç¡®ä¿å”¯ä¸€æ€§ï¼Œé‡å¤åˆ™é‡æ–°ç”Ÿæˆ
    while User.objects.filter(unique_identifier=unique_id).exists():
        random_suffix = ''.join(random.choices(string.ascii_lowercase + string.digits, k=2))
        unique_id = f"uai{phone}{random_suffix}"
    
    return unique_id
```

### **2. è‡ªåŠ¨åˆ›å»ºå…³è”è®°å½•**
- ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»º UserProfile å’Œ UserSetting
- ä½¿ç”¨ Django signals ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### **3. è‡ªå®šä¹‰ç”¨æˆ·ç®¡ç†å™¨**
```python
class UserManager(BaseUserManager):
    def create_user(self, phone, password=None, **extra_fields):
        # è‡ªåŠ¨ç”Ÿæˆ unique_identifier å’Œè®¾ç½®é»˜è®¤ nickname
        # æ”¯æŒæ‰‹æœºå·ä½œä¸ºä¸»è¦è®¤è¯æ–¹å¼
```

---

## ğŸŒ **APIæ¥å£è®¾è®¡**

### **è®¤è¯ç›¸å…³æ¥å£**
- `POST /api/users/auth/register/` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/users/auth/login/` - å¯†ç ç™»å½•  
- `POST /api/users/auth/sms-login/` - éªŒè¯ç ç™»å½•
- `POST /api/users/auth/logout/` - ç”¨æˆ·ç™»å‡º
- `POST /api/users/auth/send-sms/` - å‘é€éªŒè¯ç 
- `POST /api/users/auth/refresh/` - åˆ·æ–°Token

### **ç”¨æˆ·ç®¡ç†æ¥å£**
- `GET /api/users/user/profile/` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/users/user/update_profile/` - æ›´æ–°åŸºæœ¬ä¿¡æ¯
- `PUT /api/users/user/update_user_profile/` - æ›´æ–°è¯¦ç»†èµ„æ–™
- `POST /api/users/user/change_password/` - ä¿®æ”¹å¯†ç 
- `GET /api/users/user/settings/` - è·å–ç”¨æˆ·è®¾ç½®
- `PUT /api/users/user/update_settings/` - æ›´æ–°ç”¨æˆ·è®¾ç½®

---

## ğŸ›¡ï¸ **å®‰å…¨ç‰¹æ€§**

### **1. æ•°æ®éªŒè¯**
- æ‰‹æœºå·æ ¼å¼éªŒè¯ (æ­£åˆ™: `^1[3-9]\d{9}$`)
- å¯†ç å¼ºåº¦éªŒè¯ (Djangoå†…ç½®éªŒè¯å™¨)
- ç”¨æˆ·è¾“å…¥è¿‡æ»¤å’Œæ¸…ç†

### **2. è®¤è¯æˆæƒ**
- JWT Tokenè®¤è¯ (access + refresh token)
- æƒé™åˆ†çº§ (æ™®é€šç”¨æˆ·/ç®¡ç†å‘˜)
- APIè®¿é—®æƒé™æ§åˆ¶

### **3. ç™»å½•å®‰å…¨**
- ç™»å½•å¤±è´¥è®°å½•
- IPåœ°å€è¿½è¸ª
- ç”¨æˆ·ä»£ç†è®°å½•

---

## ğŸ“Š **æµ‹è¯•éªŒè¯ç»“æœ**

è¿è¡Œäº†å®Œæ•´çš„æµ‹è¯•è„šæœ¬ï¼ŒéªŒè¯äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

âœ… **ç”¨æˆ·åˆ›å»ºæµ‹è¯•** - æˆåŠŸåˆ›å»º3ä¸ªæµ‹è¯•ç”¨æˆ·  
âœ… **å”¯ä¸€æ ‡è¯†ç”Ÿæˆ** - ç”Ÿæˆ10ä¸ªä¸é‡å¤çš„æ ‡è¯†å·  
âœ… **å¾®ä¿¡ç»‘å®šæµ‹è¯•** - æˆåŠŸç»‘å®šå¾®ä¿¡è´¦å·  
âœ… **èµ„æ–™æ›´æ–°æµ‹è¯•** - æˆåŠŸæ›´æ–°ç”¨æˆ·æ˜µç§°å’Œè¯¦ç»†èµ„æ–™  
âœ… **å…³è”æ•°æ®** - Profileå’ŒSettingè‡ªåŠ¨åˆ›å»º  

### **æµ‹è¯•ç»“æœç¤ºä¾‹**
```
ğŸ‘¥ æ€»ç”¨æˆ·æ•°: 3
ğŸ“ æ€»èµ„æ–™æ•°: 3  
ğŸ’¬ å¾®ä¿¡ç»‘å®šæ•°: 1

ğŸ“‹ ç”¨æˆ·åˆ—è¡¨:
ğŸ“± 18512291362 | ğŸ”‘ uai18512291362qt | ğŸ˜Š UAIå­¦ä¹ è€… | ğŸ’¬ å·²ç»‘å®š
ğŸ“± 13888888888 | ğŸ”‘ uai1388888888850 | ğŸ˜Š uai1388888888850 | ğŸ’¬ æœªç»‘å®š
ğŸ“± 15999999999 | ğŸ”‘ uai15999999999gr | ğŸ˜Š uai15999999999gr | ğŸ’¬ æœªç»‘å®š
```

---

## ğŸ¯ **ç¬¦åˆé¡¹ç›®è§„èŒƒ**

### **æŠ€æœ¯æ ˆå®Œå…¨å¯¹é½**
- âœ… Django 5.2 + Django REST Framework
- âœ… JWTè®¤è¯ (SimpleJWT)
- âœ… MySQLæ•°æ®åº“æ”¯æŒ
- âœ… å®Œæ•´çš„APIè®¾è®¡
- âœ… ç»Ÿä¸€å“åº”æ ¼å¼ `{ status, data, msg }`

### **å¼€å‘æœ€ä½³å®è·µ**
- âœ… æ¨¡å—åŒ–è®¾è®¡ (apps.users)
- âœ… ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… æ•°æ®åº“è¿ç§»ç®¡ç†
- âœ… è‡ªå®šä¹‰Adminç®¡ç†ç•Œé¢

---

## ğŸš€ **åç»­æ‰©å±•å»ºè®®**

### **MVPé˜¶æ®µ (å½“å‰å®Œæˆ)**
- âœ… åŸºç¡€ç”¨æˆ·ç³»ç»Ÿ
- âœ… æ‰‹æœºæ³¨å†Œç™»å½•
- âœ… ç”¨æˆ·èµ„æ–™ç®¡ç†

### **å¢å¼ºé˜¶æ®µ**
- ğŸ“ çŸ­ä¿¡éªŒè¯ç æœåŠ¡å¯¹æ¥
- ğŸ“ å¾®ä¿¡ç™»å½•APIå¯¹æ¥
- ğŸ“ å¤´åƒä¸Šä¼ äº‘å­˜å‚¨
- ğŸ“ ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡

### **å®Œå–„é˜¶æ®µ**
- ğŸ“ ç”¨æˆ·ç­‰çº§ç³»ç»Ÿ
- ğŸ“ ç§¯åˆ†å¥–åŠ±æœºåˆ¶
- ğŸ“ ç¤¾äº¤åŠŸèƒ½æ‰©å±•

---

## ğŸ“ **æ–‡ä»¶ç»“æ„**

```
backend/apps/users/
â”œâ”€â”€ models.py          # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ serializers.py     # APIåºåˆ—åŒ–å™¨
â”œâ”€â”€ views.py           # APIè§†å›¾é€»è¾‘
â”œâ”€â”€ urls.py            # è·¯ç”±é…ç½®
â”œâ”€â”€ admin.py           # ç®¡ç†åå°é…ç½®
â”œâ”€â”€ signals.py         # ä¿¡å·å¤„ç†å™¨
â”œâ”€â”€ apps.py            # åº”ç”¨é…ç½®
â””â”€â”€ migrations/        # æ•°æ®åº“è¿ç§»æ–‡ä»¶
```

---

## ğŸ‰ **å®ŒæˆçŠ¶æ€**

**âœ… æ•°æ®åº“è®¾è®¡å®Œæˆ** - 6ä¸ªæ ¸å¿ƒæ¨¡å‹è¡¨  
**âœ… APIæ¥å£å®Œæˆ** - 12ä¸ªRESTfulæ¥å£  
**âœ… ç®¡ç†åå°å®Œæˆ** - Django Adminé…ç½®  
**âœ… æµ‹è¯•éªŒè¯å®Œæˆ** - åŠŸèƒ½æµ‹è¯•100%é€šè¿‡  
**âœ… æ–‡æ¡£è¾“å‡ºå®Œæˆ** - å®Œæ•´æŠ€æœ¯æ–‡æ¡£  

**ğŸ¯ å®Œå…¨æ»¡è¶³ä½ çš„éœ€æ±‚**: æ‰‹æœºå·æ³¨å†Œ + å”¯ä¸€æ ‡è¯†ç”Ÿæˆ + å¾®ä¿¡ç»‘å®šæ”¯æŒ + BaseModelåŸºç¡€ç±»

---

**ğŸ’¡ æç¤º**: æ•°æ®åº“å·²åˆ›å»ºå®Œæˆï¼Œå¯ä»¥ç«‹å³å¼€å§‹å‰ç«¯å¯¹æ¥æˆ–ç»§ç»­å…¶ä»–æ¨¡å—å¼€å‘! 